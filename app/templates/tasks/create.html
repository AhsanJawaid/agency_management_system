{% extends 'base.html' %}
{% block title %}Tasks Listing{% endblock %}
{% block content %}
<div class="container mt-5">
  <h2>Create Task</h2>
  <a href="{{ url_for('main.dashboard') }}">Dashboard</a> / <a href="{{ url_for('tasks.list_tasks') }}">Tasks Listing</a>
  <form method="POST">
    {{ form.hidden_tag() }}
    <div class="mb-3">{{ form.job_id.label }} {{ form.job_id(class="form-control",id="job-dropdown") }}</div>
    <div class="mb-3">{{ form.project_id.label }} {{ form.project_id(class="form-control",id="project-dropdown") }}</div>
    <div class="mb-3">{{ form.assigned_to_email.label }} {{ form.assigned_to_email(class="form-control") }}</div>
    <div class="mb-3">{{ form.deadline_datetime.label }} {{ form.deadline_datetime(class="form-control") }}</div>
    <div class="mb-3">{{ form.priority.label }} {{ form.priority(class="form-control") }}</div>
    <div class="mb-3">{{ form.description.label }} {{ form.description(class="form-control") }}</div>
    {{ form.submit(class="btn btn-primary") }}
  </form>

</div>
{% block scripts %}
<script>
  document.addEventListener('DOMContentLoaded', () => {
    document.getElementById('job-dropdown').addEventListener('change', function () {
      const jobId = this.value;
      const projectDropdown = document.getElementById('project-dropdown');

      fetch(`/tasks/projects-by-job/${jobId}`)
        .then(res => res.json())
        .then(data => {
          projectDropdown.innerHTML = '';
          data.forEach(project => {
            const opt = document.createElement('option');
            opt.value = project.id;
            opt.textContent = project.title;
            projectDropdown.appendChild(opt);
          });
        })
        .catch(err => console.error("Failed to load projects:", err));
    });
  });
</script>
{% endblock %}

{% endblock %}